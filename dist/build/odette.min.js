!function(n,t,e){"function"==typeof define&&define.amd?define([],function(){return e(n)}):"object"==typeof exports?module.exports=e(n,t):n[t]=e(n,t)}(this,"Odette",function(n,t){"use strict";var e,i="0.0.0",r="",o="definitions cannot fail due to errors",u="length",s="global",c="prototype",f="location",a=".",h=this||n,p=h.document,d=!0,l=!1,g=null,v={"{":1,"[":2},E={"}":1,"]":2},y=function(){},O=function(n){return function(t){return typeof t===n}},S=function(){return+new Date},V=function(n,t){for(var e=0,i=n&&n.slice(0),r=i&&i[u],o=[];r>e;)o[e]=t(i[e],e,i),e++;return o},R=O("string"),m=O("number"),A=O("function"),x=O("object"),D=function(n){return Array.isArray(n)},C=function(n){return(x(n)?JSON.stringify(n):A(n)?n.toString():n)+r},T=S(),N=function(n,t){return function(){return t.apply(n,arguments)}},b=function(n,t,e){var i,r=g;try{i=n()}catch(o){r=o,i=t?t(o,i):i}finally{i=e?e(r,i):i}return i},I=function(n){return m(n)||R(n)&&(n.split(a)[u]>1||+n===+n)?d:l},w=function(n,t){var i,r,o,s=q(n),c=q(t);return s===d?d:c===d?d:s===l&&c===l?(i=n.split(a),r=t.split(a),V(i,function(n,t){+n<+(r[t]||0)&&(o=d)}),1===i[u]&&3===r[u]?d:3===i[u]&&1===r[u]?l:(o===e&&r[u]>i[u]&&(o=d),!!o)):n<=t},H=function(n){return function(){return n}},W=function(n){var t=n.url,i=[];return x(n)?(j(n.query,function(n,t){n!==e&&(n=encodeURIComponent(C(n)),i.push(t+"="+n))}),i[u]&&(t+="?"),t+=i.join("&"),n.hash&&(n.hash=x(n.hash)?encodeURI(C(n.hash)):hash,t+="#"+n.hash)):t=n,t},q=function(n){var t,e=n;return m(e)?e:(e+=r,t=+e,t===t?t:1===e.split(a)[u])},P=function(n){var t,e,i,o,s,c,a,p=0,g=n,y=h.decodeURIComponent,O=function(){return JSON.parse(o)},S=function(){return o};for(R(g)||(g=g[f].search),"?"===g[0]&&(g=g.slice(1)),i=g.split("&"),t={};p<i[u];p++)e=i[p].split("="),e[0]&&(e[u]<2&&e[PUSH](r),o=e[1],o=y(o),"'"!==o[0]&&'"'!==o[0]||(o=o.slice(1,o[u]-1)),o===d+r&&(o=d),o===l+r&&(o=l),R(o)&&(s=+o,s==o&&s+r===o?o=s:(c=v[o[0]])&&(a=E[o[o.length-1]])&&c===a&&(o=b(O,S))),t[y(e[0])]=o);return t},_=function(n){throw new Error(n)},j=function(n,t,e){var i,r,o=n;if(x(o))if(D(o))V(o,t);else{r=[];for(i in o)o.hasOwnProperty(i)&&r.push(i);V(r,function(n){t.apply(e||this,[o[n],n,o])})}return o},U=function(n,t){return j(t,function(t,e){n[e]=t}),n},k=function(n){return b(function(){var t=n.document;return!!t},function(){return l})},J=[],L=function(t,r,f,a,v,E){function O(n,t){return this.SCOPED=d,this.CREATED_AT=S(),this.VERSION=n,this.application=this,this.missedDefinitions=[],this.definedAgainst=[],this}var D=O[c];D.extend=function(n){return this.merge(this,n)},D.merge=U,D.each=j,D.extend({exception:_,destroy:y,wraptry:b,now:S,map:V,touchable:k,isVersionString:I,Odette:L,stringifyQuery:W,parseSearch:P,toJSON:function(){return{CREATED_AT:this.CREATED_AT,VERSION:this.VERSION,SCOPED:this.SCOPED,WHERE:this.global.WHERE}},undefine:function(n){return this.missedDefinitions.push(n),this.defining&&n.apply(this,[this,this.definingAgainst,this.definingWith]),this},parody:function(n){for(var t=this,e=0,i={},r=t[s];e<n[u];e++)i[n[e]]=N(r,r[n[e]]);return t.extend(i),t},scope:function(n,t){var e=n&&R(n)?n:this.VERSION,i=n&&(A(n)?n:A(t)?t:g);return this[s].scope(e,i)},block:function(n){return n.apply(this,[this])},counter:function(n){return L.counter(n)},definition:function(n,t){var e,i,r,u=this;return u.definedAgainst.indexOf(n)>-1?u:(u.definedAgainst.push(n),e=n.Odette,r=t||{},u.defined?V(u.missedDefinitions,function(t){t.apply(u,[u,n,r])}):(i=J.slice(0),J=[],V(i,function(t){u.defining&&_(o),u.defining=d,u.definingAgainst=n,u.definingWith=r,b(function(){t.handler.apply(u,[u,n,r]),u.defining=l,u.defined=d},function(n){console.log(n)})})),u.defining&&_(o),u)}});var C=function(n,t){var e={};return function(i){var r,o=i||y,u=n,s=this,c=this.global,f=c.buildContext,a=function(){r.queue.push(h)},h={app:s,context:f,handler:o};return R(u)&&(u=H(u)),(u=u(s))?(r=e[u]=e[u]||{},r.finished?(t.apply(c,[h]),o.apply(h,[s])):r.loading?a():(r.queue=[],r.loading=d,a(),c.makeScript(u,function(){var n=r.queue.slice(0);r.loading=l,r.finished=d,r.queue=[],c.registerVersion(s.VERSION),c.map(n,function(n){t.apply(c,[n]),n.handler(n.app)})},f.document)),r.queue):l}};b(function(){var n;V(E,function(t){!h[r]&&k(t)&&t[r]&&(n=d,h[r]=t[r])})});var q,Q=[],X=h[r]=h[r]||function(){return L.where.push(r),{Application:O,Odette:L,LOADED_CONTEXT:n,EXECUTED_AT:T,WHERE:r,VERSION:i,SHARED:d,SCOPED:l,versionOrder:[],versions:{},wraptry:b,maxVersion:w,map:V,loadScriptWithQueue:C,loadedAgainst:[t],queue:function(n,t){return Q.push({context:n,handler:t}),this},emptyQueue:function(n){var t=this,e=Q.slice(0),i=t.scope(),r=i.defining;return Q=[],i.defining=d,V(e,n||function(n){n.handler.apply(n.context,[t,i])}),i.defining=r,t},registerVersion:function(n,t){var e=this,i=e.versions[n],r=e.versions[n]=i||t||new O(n,e);return r[s]=e,e.currentVersion=n,e.defaultVersion=e.maxVersion(e.defaultVersion,n)?n:e.defaultVersion,i||e.versionOrder.push(n),r},definition:function(n,t,e){var i,r=this,o=n,u=t,s=e;return x(o)&&(s=u,u=o,o=r.scope().VERSION),i=r.registerVersion(o),i.definition(u,s)},unRegisterVersion:function(n){var t=this,i=t.versions[n],r=t.versionOrder.indexOf(n);return r===-1?t:(i.destroy(),t.versionOrder.splice(r,1),i[s]=e,t.versions[n]=e,i)},scope:function(n,t){var e,i,r,o=this,u=o.versions;return R(n)||m(n)?(e=n,i=t):(i=n,e=o.defaultVersion),u[e]?o.currentVersion=e:o.registerVersion(e),r=u[e],A(i)?(r.block(i),r):r},hoist:function(t,e){var i=this,r=e||n;return t?t===this.LOADED_CONTEXT?d:i.loadedAgainst.indexOf(t)+1?d:i.touch(t)?(t[i.WHERE]&&(r[i.WHERE]=t[i.WHERE]),r[i.WHERE]):l:l},registerScopedMethod:function(n,t){var e=this,i=t||3;e[n]=e[n]||function(){var t=0,r=arguments,o=r,s=r[u],c=r[0];if(s<i)c=e.currentVersion;else{for(o=[];t<r[u];t++)o.push(r[t]);c=o.shift()}e.applyTo(c,n,o)};return e},get:function(n){return this.versions[n]},applyTo:function(n,t,e){var i=this,r=i.get(n);return r&&r[t]&&r[t].apply(r,e)},getCurrentScript:function(n){var t=(n||p).scripts,e=n.currentScript,i=t[t[u]-1];return e||i},touch:k,makeScript:function(n,t,e,i){var r=e||p,o=r.createElement("script");return o.type="text/javascript",i||r.head.appendChild(o),n&&(t&&(o.onload=t),R(n)?o.src=n:o.innerHTML=n.join("\n")),o}}}();return X.buildContext=t,q=X.get(f),q||(q=X.registerVersion(f),a&&a.apply(h,[X,q])),v&&v.apply(h,[X,q]),q};return U(L,{VERSION:i,where:[],touchable:k,counter:function(){var n={},t=0;return function(e){var i;return e?(n[e]=n[e]||0,++n[e],i=n[e]):(++t,i=t),e?e+i:i}}(),definition:function(n,t){J.push({context:n,handler:t})}})});