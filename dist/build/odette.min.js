!function(n,t,e){"function"==typeof define&&define.amd?define([],function(){return e(n)}):"object"==typeof exports?module.exports=e(n,t):n[t]=e(n,t)}(this,"Odette",function(n,t){"use strict";var e,i="0.0.0",r="",o="definitions cannot fail due to errors",u="length",s="global",c="prototype",f="location",a=".",h=this||n,p=h.document,d=!0,l=!1,g=null,v={"{":1,"[":2},E={"}":1,"]":2},y=function(){},O=function(n){return typeof n},S=function(n){return function(t){return O(t)===n}},V=function(){return+new Date},R=function(n,t){for(var e=0,i=n&&n.slice(0),r=i&&i[u],o=[];r>e;)o[e]=t(i[e],e,i),e++;return o},m=S("string"),A=S("number"),x=S("function"),D=S("object"),C=function(n){return Array.isArray(n)},T=function(n){return(D(n)?JSON.stringify(n):x(n)?n.toString():n)+r},N=V(),b=function(n,t){return function(){return t.apply(n,arguments)}},I=function(n,t,e){var i,r=g;try{i=n()}catch(o){r=o,i=t?t(o,i):i}finally{i=e?e(r,i):i}return i},w=function(n){return A(n)||m(n)&&(n.split(a)[u]>1||+n===+n)?d:l},H=function(n,t){var i,r,o,s=P(n),c=P(t);return s===d?d:c===d?d:s===l&&c===l?(i=n.split(a),r=t.split(a),R(i,function(n,t){+n<+(r[t]||0)&&(o=d)}),1===i[u]&&3===r[u]?d:3===i[u]&&1===r[u]?l:(o===e&&r[u]>i[u]&&(o=d),!!o)):n<=t},W=function(n){return function(){return n}},q=function(n){var t=n.url,i=[];return D(n)?(U(n.query,function(n,t){n!==e&&(n=encodeURIComponent(T(n)),i.push(t+"="+n))}),i[u]&&(t+="?"),t+=i.join("&"),n.hash&&(n.hash=D(n.hash)?encodeURI(T(n.hash)):hash,t+="#"+n.hash)):t=n,t},P=function(n){var t,e=n;return A(e)?e:(e+=r,t=+e,t===t?t:1===e.split(a)[u])},_=function(n){var t,e,i,o,s,c,a,p=0,g=n,y=h.decodeURIComponent,O=function(){return JSON.parse(o)},S=function(){return o};for(m(g)||(g=g[f].search),"?"===g[0]&&(g=g.slice(1)),i=g.split("&"),t={};p<i[u];p++)e=i[p].split("="),e[0]&&(e[u]<2&&e[PUSH](r),o=e[1],o=y(o),"'"!==o[0]&&'"'!==o[0]||(o=o.slice(1,o[u]-1)),o===d+r&&(o=d),o===l+r&&(o=l),m(o)&&(s=+o,s==o&&s+r===o?o=s:(c=v[o[0]])&&(a=E[o[o.length-1]])&&c===a&&(o=I(O,S))),t[y(e[0])]=o);return t},j=function(n){throw new Error(n)},U=function(n,t,e){var i,r,o=n;if(D(o))if(C(o))R(o,t);else{r=[];for(i in o)o.hasOwnProperty(i)&&r.push(i);R(r,function(n){t.apply(e||this,[o[n],n,o])})}return o},k=function(n,t){return U(t,function(t,e){n[e]=t}),n},J=function(n){return I(function(){var t=n.document;return!!t},function(){return l})},L=[],Q=function(t,r,f,a,v,E){function O(n,t){return this.SCOPED=d,this.CREATED_AT=V(),this.VERSION=n,this.application=this,this.missedDefinitions=[],this.definedAgainst=[],this}var S=O[c];S.extend=function(n){return this.merge(this,n)},S.merge=k,S.each=U,S.extend({exception:j,destroy:y,wraptry:I,now:V,map:R,touchable:J,isVersionString:w,Odette:Q,stringifyQuery:q,parseSearch:_,toJSON:function(){return{CREATED_AT:this.CREATED_AT,VERSION:this.VERSION,SCOPED:this.SCOPED,WHERE:this.global.WHERE}},undefine:function(n){return this.missedDefinitions.push(n),this.defining&&n.apply(this,[this,this.definingAgainst,this.definingWith]),this},parody:function(n){for(var t=this,e=0,i={},r=t[s];e<n[u];e++)i[n[e]]=b(r,r[n[e]]);return t.extend(i),t},scope:function(n,t){var e=n&&m(n)?n:this.VERSION,i=n&&(x(n)?n:x(t)?t:g);return this[s].scope(e,i)},block:function(n){return n.apply(this,[this])},counter:function(n){return Q.counter(n)},definition:function(n,t){var e,i,r,u=this;return u.definedAgainst.indexOf(n)>-1?u:(u.definedAgainst.push(n),e=n.Odette,r=t||{},u.defined?R(u.missedDefinitions,function(t){t.apply(u,[u,n,r])}):(i=L.slice(0),L=[],R(i,function(t){u.defining&&j(o),u.defining=d,u.definingAgainst=n,u.definingWith=r,I(function(){t.handler.apply(u,[u,n,r]),u.defining=l,u.defined=d},function(n){console.log(n)})})),u.defining&&j(o),u)}});var C=function(n,t){var e={};return function(i){var r,o=i||y,u=n,s=this,c=this.global,f=c.buildContext,a=function(){r.queue.push(h)},h={app:s,context:f,handler:o};return m(u)&&(u=W(u)),(u=u(s))?(r=e[u]=e[u]||{},r.finished?(t.apply(c,[h]),o.apply(h,[s])):r.loading?a():(r.queue=[],r.loading=d,a(),c.makeScript(u,function(){var n=r.queue.slice(0);r.loading=l,r.finished=d,r.queue=[],c.registerVersion(s.VERSION),c.map(n,function(n){t.apply(c,[n]),n.handler(n.app)})},f.document)),r.queue):l}};I(function(){var n;R(E,function(t){!h[r]&&J(t)&&t[r]&&(n=d,h[r]=t[r])})});var T,P=[],X=h[r]=h[r]||function(){return Q.where.push(r),{Application:O,Odette:Q,LOADED_CONTEXT:n,EXECUTED_AT:N,WHERE:r,VERSION:i,SHARED:d,SCOPED:l,versionOrder:[],versions:{},wraptry:I,maxVersion:H,map:R,loadScriptWithQueue:C,loadedAgainst:[t],queue:function(n,t){return P.push({context:n,handler:t}),this},emptyQueue:function(n){var t=this,e=P.slice(0),i=t.scope(),r=i.defining;return P=[],i.defining=d,R(e,n||function(n){n.handler.apply(n.context,[t,i])}),i.defining=r,t},registerVersion:function(n,t){var e=this,i=e.versions[n],r=e.versions[n]=i||t||new O(n,e);return r[s]=e,e.currentVersion=n,e.defaultVersion=e.maxVersion(e.defaultVersion,n)?n:e.defaultVersion,i||e.versionOrder.push(n),r},definition:function(n,t,e){var i,r=this,o=n,u=t,s=e;return D(o)&&(s=u,u=o,o=r.scope().VERSION),i=r.registerVersion(o),i.definition(u,s)},unRegisterVersion:function(n){var t=this,i=t.versions[n],r=t.versionOrder.indexOf(n);return r===-1?t:(i.destroy(),t.versionOrder.splice(r,1),i[s]=e,t.versions[n]=e,i)},scope:function(n,t){var e,i,r,o=this,u=o.versions;return m(n)||A(n)?(e=n,i=t):(i=n,e=o.defaultVersion),u[e]?o.currentVersion=e:o.registerVersion(e),r=u[e],x(i)?(r.block(i),r):r},hoist:function(t,e){var i=this,r=e||n;return t?t===this.LOADED_CONTEXT?d:i.loadedAgainst.indexOf(t)+1?d:i.touch(t)?(t[i.WHERE]&&(r[i.WHERE]=t[i.WHERE]),r[i.WHERE]):l:l},registerScopedMethod:function(n,t){var e=this,i=t||3;e[n]=e[n]||function(){var t=0,r=arguments,o=r,s=r[u],c=r[0];if(s<i)c=e.currentVersion;else{for(o=[];t<r[u];t++)o.push(r[t]);c=o.shift()}e.applyTo(c,n,o)};return e},get:function(n){return this.versions[n]},applyTo:function(n,t,e){var i=this,r=i.get(n);return r&&r[t]&&r[t].apply(r,e)},getCurrentScript:function(n){var t=(n||p).scripts,e=n.currentScript,i=t[t[u]-1];return e||i},touch:J,makeScript:function(n,t,e,i){var r=e||p,o=r.createElement("script");return o.type="text/javascript",i||r.head.appendChild(o),n&&(t&&(o.onload=t),m(n)?o.src=n:o.innerHTML=n.join("\n")),o}}}();return X.buildContext=t,T=X.get(f),T||(T=X.registerVersion(f),a&&a.apply(h,[X,T])),v&&v.apply(h,[X,T]),T};return k(Q,{VERSION:i,where:[],touchable:J,counter:function(){var n={},t=0;return function(e){var i;return e?(n[e]=n[e]||0,++n[e],i=n[e]):(++t,i=t),e?e+i:i}}(),definition:function(n,t){L.push({context:n,handler:t})}})});