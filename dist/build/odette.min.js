!function(n,t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():n.Odette=e()}(this,"Odette",function(n){"use strict";var t,e="0.0.0",i="",r="definitions cannot fail due to errors",o="length",u="global",s="prototype",c=".",f=this||window,a=f.document,p=!0,h=!1,d=null,l=function(){},v=function(n){return function(t){return typeof t===n}},g=function(){return+new Date},y=function(n,t){for(var e=0,i=n&&n.slice(0),r=i&&i[o],u=[];r>e;)u[e]=t(i[e],e,i),e++;return u},E=v("string"),O=v("number"),m=v("function"),V=v("object"),x=function(n){return Array.isArray(n)},R=g(),S=function(n,t){return function(){return t.apply(n,arguments)}},w=function(n,t,e){var i,r=d;try{i=n()}catch(o){r=o,i=t?t(o,i):i}finally{i=e?e(r,i):i}return i},A=function(n,e){var i,r,u,s=T(n),f=T(e);return s===p?p:f===p?p:s===h&&f===h?(i=n.split(c),r=e.split(c),y(i,function(n,t){+n<+(r[t]||0)&&(u=p)}),1===i[o]&&3===r[o]?p:3===i[o]&&1===r[o]?h:(u===t&&r[o]>i[o]&&(u=p),!!u)):e>=n},C=function(n){return function(){return n}},D=function(n){var e=n.url,i=[];return V(n)?(b(n.query,function(n,e){n!==t&&(n=encodeURIComponent(stringify(n)),i.push(e+"="+n))}),i[o]&&(e+="?"),e+=i.join("&"),n.hash&&(n.hash=V(n.hash)?encodeURI(stringify(n.hash)):hash,e+="#"+n.hash)):e=n,e},T=function(n){var t,e=n;return O(e)?e:(e+=i,t=+e,t===t?t:1===e.split(c)[o])},I=function(n){var t,e,r,u,s,c=0,a=n,d=f.decodeURIComponent;for(E(a)||(a=a[LOCATION].search),"?"===a[0]&&(a=a.slice(1)),r=a.split("&"),t={};c<r[o];c++)e=r[c].split("="),e[0]&&(e[o]<2&&e[PUSH](i),u=e[1],u=d(u),"'"!==u[0]&&'"'!==u[0]||(u=u.slice(1,u[o]-1)),u===p+i&&(u=p),u===h+i&&(u=h),E(u)&&(s=+u,s==u&&s+i===u&&(u=s)),t[d(e[0])]=u);return t},N=function(n){throw new Error(n)},b=function(n,t,e){var i,r,o=n;if(V(o))if(x(o))y(o,t);else{r=[];for(i in o)o.hasOwnProperty(i)&&r.push(i);y(r,function(n){t.apply(e||this,[o[n],n,o])})}return o},H=function(n,t){return b(t,function(t,e){n[e]=t}),n},W=function(n){return w(function(){var t=n.document;return!!t},function(){return h})},q=[];return H(function(n,i,c,v,x,T){function j(n,t){return this.SCOPED=p,this.CREATED_AT=g(),this.VERSION=n,this.application=this,this.missedDefinitions=[],this}j[s].extend=function(n){return this.merge(this,n)},j[s].merge=H,j[s].each=b,j[s].extend({exception:N,destroy:l,wraptry:w,now:g,stringifyQuery:D,parseSearch:I,undefine:function(n){return this.missedDefinitions.push(n),this.defining&&n.apply(this,[this,this.definingAgainst,this.definingWith]),this},parody:function(n){for(var t=this,e=0,i={},r=t[u];e<n[o];e++)i[n[e]]=S(r,r[n[e]]);return t.extend(i),t},scope:function(n,t){var e=n&&E(n)?n:this.VERSION,i=n&&(m(n)?n:m(t)?t:d);return this[u].scope(e,i)},counter:function(n){return Odette.counter(n)}});var U=function(n,t){var e={};return function(i){var r,o=i||l,u=n,s=this,c=this.global,f=c.buildContext,a=function(){r.queue.push(d)},d={app:s,context:f,handler:o};return E(u)&&(u=C(u)),(u=u(s))?(r=e[u]=e[u]||{},r.finished?(t.apply(c,[d]),o.apply(d,[s])):r.loading?a():(r.queue=[],r.loading=p,a(),c.makeScript(u,function(){var n=r.queue.slice(0);console.log(this),r.loading=h,r.finished=p,r.queue=[],c.registerVersion(s.VERSION),c.map(n,function(n){t.apply(c,[n]),n.handler(n.app)})},f.document)),r.queue):h}};w(function(){var n;y(T,function(t){!f[i]&&W(t)&&t[i]&&(n=p,f[i]=t[i])})});var L,P=[],_=f[i]=f[i]||function(){return Odette.where.push(i),{Application:j,LOADED_CONTEXT:window,EXECUTED_AT:R,WHERE:i,VERSION:e,SHARED:p,SCOPED:h,versionOrder:[],versions:{},wraptry:w,maxVersion:A,map:y,loadScriptWithQueue:U,loadedAgainst:[n],queue:function(n,t){return P.push({context:n,handler:t}),this},emptyQueue:function(n){var t=P.slice(0),e=this,i=e.scope();return P=[],y(t,n||function(n){n.handler.apply(n.context,[e,i])}),e},registerVersion:function(n,t){var e=this,i=e.versions[n],r=e.versions[n]=i||t||new j(n,e);return r[u]=e,e.currentVersion=n,e.defaultVersion=e.maxVersion(e.defaultVersion,n)?n:e.defaultVersion,i||e.versionOrder.push(n),r},definition:function(n,t,e){var i,o,u,s,c=this,f=n,a=t,d=e;return V(f)&&(d=a,a=f,f=c.scope().VERSION),i=c.registerVersion(f),o=a.Odette,u=q.slice(0),q=[],s=d||{},i.defined?y(i.missedDefinitions,function(n){n.apply(i,[i,a,s])}):y(u,function(n){i.defining&&N(r),i.defining=p,i.definingAgainst=a,i.definingWith=s,w(function(){n.handler.apply(i,[i,a,s]),i.defining=h,i.defined=p})}),i.defining&&N(r),i},unRegisterVersion:function(n){var e=this,i=e.versions[n],r=e.versionOrder.indexOf(n);return-1===r?e:(i.destroy(),e.versionOrder.splice(r,1),i[u]=t,e.versions[n]=t,i)},scope:function(n,t){var e,i,r,o=this,u=o.versions;return E(n)||O(n)?(e=n,i=t):(i=n,e=o.defaultVersion),u[e]?o.currentVersion=e:o.registerVersion(e),r=u[e],m(i)?(i.apply(o,[r]),r):r},hoist:function(n,t){var e=this,i=t||window;return n?n===this.LOADED_CONTEXT?p:e.loadedAgainst.indexOf(n)+1?p:e.touch(n)?(n[e.WHERE]&&(i[e.WHERE]=n[e.WHERE]),i[e.WHERE]):h:h},registerScopedMethod:function(n,t){var e=this,i=t||3;e[n]=e[n]||function(){var t=0,r=arguments,u=r,s=r[o],c=r[0];if(i>s)c=e.currentVersion;else{for(u=[];t<r[o];t++)u.push(r[t]);c=u.shift()}e.applyTo(c,n,u)};return e},get:function(n){return this.versions[n]},applyTo:function(n,t,e){var i=this,r=i.get(n);return r&&r[t]&&r[t].apply(r,e)},getCurrentScript:function(n){var t=(n||a).scripts,e=n.currentScript,i=t[t[o]-1];return e||i},touch:W,makeScript:function(n,t,e,i){var r=e||a,o=r.createElement("script");return o.type="text/javascript",i||r.head.appendChild(o),n&&(t&&(o.onload=t),E(n)?o.src=n:o.innerHTML=n.join("\n")),o}}}();return _.buildContext=n,L=_.get(c),L||(L=_.registerVersion(c),v.apply(f,[_,L])),x&&x.apply(f,[_,L]),L},{VERSION:e,where:[],touchable:W,counter:function(){var n={},t=0;return function(e){var i;return e?(n[e]=n[e]||0,++n[e],i=n[e]):(++t,i=t),e?e+i:i}}(),definition:function(n,t){q.push({context:n,handler:t})}})});